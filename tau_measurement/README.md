# 大気の光学的厚み測定プログラム

このプログラムは、ant30ログファイルおよびパワーメーターログファイルを用いて、各ON観測点における平均出力を計算し、
R-skyとの出力の差から、天頂方向の大気の光学的厚み（τ₀）、受信機雑音温度（T_rx）、システム雑音温度（T_sys）を推定する。

---

## 実行方法

```bash
python3 TauCalculator.py ant30ログファイル名 powerログファイル名
```

### 例

```bash
python3 TauCalculator.py ant30-tau1-20240925.log power-20240915.log
```

実行時に大気温度（T_atm）をキーボード入力する。

---

## 入力ファイルの内容

### ant30ログファイル

- 各ON観測終了時刻を含むログ（例：`# On-Point  Integ end`）
- `OnOffTime` および `RSkyTime` の記述が必要（例：`OnOffTime 10`）
- R点観測終了時刻（例：`# R-Sky     Integ end`）

### powerログファイル

- フォーマットは次の通り（時刻と出力値）：

```
[yyyy/mm/dd-hh:mm:ss.ms] power_value
```
※

例：時刻のフォーマットは必要に応じて変更してください！

---

## プログラムの処理内容

1. **ログ読み取り**  
   - `ant30.log` から各ON点の終了時刻を取得し、`OnOffTime` を用いて開始時刻を逆算  
   - `power.log` から各ON点の観測時刻範囲に対応する電力値を抽出し、平均化

2. **R観測の処理**  
   - R点観測の開始・終了時刻を抽出し、対応するパワー値の平均値を算出（V_R）

3. **secZ（天頂角の余割）計算**  
   - EL（仰角）から secZ を計算：`secZ = 1 / cos(90 - EL)`

4. **線形フィッティング**  
   - y軸：`ln[(V_R - V(Z)) / V_R]`  
   - x軸：`secZ`  
   - 最小二乗法で線形フィッティングし、傾きから `τ₀`、切片から `T_rx` および `T_sys` を求める

5. **プロット出力**  
   - `ant30ログファイル名.png` という名前で、フィッティング結果をグラフとして保存

6. **結果の保存**  
   - EL, secZ, power の一覧を `.txt` 形式で保存（例：`ant30-tau1-202409025.txt`）

---

## 出力ファイル

- `*.png`：secZ vs ln[(V_R - V(Z)) / V_R] のフィッティング結果プロット
- `*.txt`：EL, secZ, 各点の平均出力のテーブル

---

## 出力例（標準出力）

```
大気の温度 T_atm [K] を入力: 270
最小二乗フィッティング: y = -0.285 secZ + 0.245
天頂方向の光学的厚み tau_0 = 0.285
T_atm = 270.000 K
T_rx = 66.302 K
T_sys = 85.113 K
```

---

